digraph PropertyScraperArchitecture {
  rankdir=TB;
  ranksep=0.9;
  node [shape=box, style=rounded];

  idealista [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/idealista.png"/></TD>
          <TD ALIGN="LEFT">Idealista</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05"
  ];
  browser_idealista [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/chrome.png"/></TD>
          <TD>Instrumented web browser<BR/>(Chromium or Chrome)</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05"
  ];
  rabbitmq1 [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/rabbitMq.png"/></TD>
          <TD ALIGN="LEFT">Rabbit<BR/>(pending-image-urls-to-download queue)</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05"
  ];
  rabbitmq2 [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/rabbitMq.png"/></TD>
          <TD ALIGN="LEFT">Rabbit<BR/>(outgoing-notification-messages queue)</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05"
  ];
  idealista_scraper [
    label="idealistaPropertyScraper",
    style="rounded,filled",
    fillcolor="#80ff80",
    fixedsize=true,
    height=1.5,
    width=3.8
  ];
  mongodb [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/mongoDB.png"/></TD>
          <TD>MongoDB</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05",
    shape=cylinder
  ];
  notification_message_sender [label="notificationMessageSender", style="rounded,filled", fillcolor="#80ff80"];
  property_backend [label="propertyBackend", style="rounded,filled", fillcolor="#80ff80"];
  property_frontend [label="propertyFrontend", style="rounded,filled", fillcolor="#80ff80"];
  whatsapp [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/whatsapp.png"/></TD>
          <TD>Whatsapp</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05"
  ];
  prometheus [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/prometheus.png"/></TD>
          <TD>Prometheus</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05",
    color=darkgreen
  ];
  grafana [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/grafana.png"/></TD>
          <TD>Grafana</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05",
    color=darkgreen
  ];
  browser_backoffice [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/chrome.png"/></TD>
          <TD>Web browser</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05"
  ];
  fizgon_user [
    label="ðŸ‘¤ User",
    shape=plaintext,
    style="",
    color=transparent,
    fontcolor=black
  ];
  nfs_image_folder [label="nfsImageFolder", style="rounded,filled", shape=cylinder, fillcolor="#ffffff"];
  images_nginx [
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLPADDING="2" CELLSPACING="0">
        <TR>
          <TD><IMG SRC="doc/architecture/nginx.png"/></TD>
          <TD>Static assets<BR/>web server</TD>
        </TR>
      </TABLE>
    >,
    margin="0.08,0.05"
  ];

  { rank=min; idealista; }
  { rank=same; idealista_scraper; rabbitmq2; }
  { rank=same; mongodb; grafana; }
  { rank=max; fizgon_user; browser_backoffice; property_frontend; property_backend; }

  idealista -> browser_idealista [xlabel="Can use proxy"];
  browser_idealista -> idealista_scraper;
  idealista_scraper -> mongodb [minlen=2, dir=both];
  idealista_scraper -> rabbitmq2 [style=invis, weight=100, constraint=false, minlen=2];
  idealista_scraper -> rabbitmq1 [minlen=2];
  idealista_scraper -> browser_idealista [color=blue];
  idealista_scraper -> rabbitmq2 [tailport=e, headport=w, weight=100];
  idealista_scraper -> prometheus [color=darkgreen];
  rabbitmq2 -> notification_message_sender;
  notification_message_sender -> whatsapp;
  notification_message_sender -> prometheus [color=darkgreen];
  prometheus -> grafana [color=darkgreen];
  mongodb -> property_backend;
  property_frontend -> browser_backoffice [minlen=2];
  property_backend -> property_frontend [minlen=2];
  browser_backoffice -> fizgon_user [minlen=2, dir=both];
  idealista_scraper -> nfs_image_folder;
  whatsapp -> fizgon_user;
  nfs_image_folder -> images_nginx;
  images_nginx -> browser_backoffice;
}
